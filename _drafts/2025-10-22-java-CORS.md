---
title: Understanding CORS in Java
date: 2025-10-22 16:06:29 +0800
categories: [Java, Web Development]
tags: [CORS, Java, HTTP, Web Security]
description: A comprehensive guide to Cross-Origin Resource Sharing (CORS) in Java applications, including configuration and best practices.
---

## 什么是CORS？

**跨域资源访问（Cross-Origin Resource Sharing，简称CORS）** 是现代Web开发中的一个重要概念，用于解决浏览器同源策略（Same-Origin Policy）带来的限制。

- **定义**：CORS是一种机制，允许浏览器从一个域名（origin）下的网页向另一个域名下的服务器发起请求。这打破了同源策略的限制，同源策略要求请求的协议、域名和端口必须完全相同。
- **为什么需要**：在前后端分离的架构中，前端（例如React或Vue应用）通常运行在 `http://localhost:3000`，而后端API在 `http://localhost:8080`。如果没有CORS，浏览器会阻止这种跨域请求，导致前端无法获取数据。

## CORS的工作原理

CORS通过HTTP头部来实现控制：

1. **简单请求（Simple Requests）**：浏览器直接发送请求，并在响应中检查 `Access-Control-Allow-Origin` 等头部。
2. **预检请求（Preflight Requests）**：对于复杂请求（如使用非GET/POST方法或自定义头部），浏览器先发送一个OPTIONS请求询问服务器是否允许该请求。如果服务器响应允许，浏览器才会发送实际请求。

关键HTTP头部：
- `Access-Control-Allow-Origin`: 指定允许访问的源（例如 `*` 表示所有源）。
- `Access-Control-Allow-Methods`: 指定允许的HTTP方法（如 `GET, POST, PUT`）。
- `Access-Control-Allow-Headers`: 指定允许的请求头部。
- `Access-Control-Allow-Credentials`: 是否允许发送凭据（如Cookies）。

## 在Java/Spring Boot中配置CORS

Spring Boot提供了多种方式来启用和配置CORS：

1. **全局配置（推荐）**：通过实现 `WebMvcConfigurer` 接口，在配置类中添加CORS映射。

   ```java
   import org.springframework.context.annotation.Configuration;
   import org.springframework.web.servlet.config.annotation.CorsRegistry;
   import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

   @Configuration
   public class WebConfig implements WebMvcConfigurer {

       @Override
       public void addCorsMappings(CorsRegistry registry) {
           registry.addMapping("/api/**")  // 允许跨域的路径模式
                   .allowedOrigins("http://localhost:3000", "https://example.com")  // 允许的源
                   .allowedMethods("GET", "POST", "PUT", "DELETE")  // 允许的方法
                   .allowedHeaders("*")  // 允许的头部
                   .allowCredentials(true)  // 是否允许凭据
                   .maxAge(3600);  // 预检请求缓存时间（秒）
       }
   }
   ```

2. **控制器级别配置**：使用 `@CrossOrigin` 注解直接在控制器或方法上配置。

   ```java
   import org.springframework.web.bind.annotation.CrossOrigin;
   import org.springframework.web.bind.annotation.GetMapping;
   import org.springframework.web.bind.annotation.RestController;

   @RestController
   @CrossOrigin(origins = "http://localhost:3000", methods = {RequestMethod.GET, RequestMethod.POST})
   public class MyController {

       @GetMapping("/api/data")
       public String getData() {
           return "Hello from API!";
       }
   }
   ```

3. **过滤器方式**：手动添加CORS头部（适用于非Spring MVC应用）。

   ```java
   import javax.servlet.*;
   import javax.servlet.http.HttpServletResponse;
   import java.io.IOException;

   public class CorsFilter implements Filter {

       @Override
       public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
               throws IOException, ServletException {
           HttpServletResponse httpResponse = (HttpServletResponse) response;
           httpResponse.setHeader("Access-Control-Allow-Origin", "*");
           httpResponse.setHeader("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
           httpResponse.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
           chain.doFilter(request, response);
       }
   }
   ```

## 使用场景和最佳实践

- **使用场景**：前后端分离项目、API服务、微服务架构。
- **最佳实践**：
  - 生产环境中，避免使用 `*` 通配符，明确指定允许的源。
  - 对于敏感操作，谨慎使用 `allowCredentials(true)`。
  - 测试时，使用浏览器开发者工具检查CORS错误（通常显示为“Access-Control-Allow-Origin”相关错误）。
  - 如果是单页应用（SPA），确保前端正确处理预检请求。

通过正确配置CORS，您可以安全地实现跨域通信，同时保护服务器免受恶意请求。
